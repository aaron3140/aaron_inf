package common.utils;


import java.security.cert.X509Certificate;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.sun.org.apache.xml.internal.security.utils.Base64;
import common.utils.verify.NETCAPKI;

/**
 * 
 * 本类描述: 
 * @version: 企业帐户前置接口 v1.0 
 * @author: 广州天讯瑞达通讯技术有限公司(zhuxiaojun)
 * @email:  zhuxiaojun@tisson.com
 * @time: 2013-4-1下午12:02:35
 */
public class TestSign {
	private static final Log log = LogFactory.getLog(TestSign.class);
	/**
	 * @param args
	 */
	public static void main(String[] args) {
		// TODO Auto-generated method stub

		boolean result=false;
		try {
			result = TestSign.verify2FileByCert();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	public static boolean verify2FileByCert()
	throws Exception {
//		String sBase64Cert = "MIIEAzCCAuugAwIBAgIQaByrVM2PXDnlj+FV8Vik6TANBgkqhkiG9w0BAQUFADBvMQswCQYDVQQG"+
//"EwJDTjEkMCIGA1UEChMbTkVUQ0EgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MRkwFwYDVQQLExBTZXJ2"+
//"ZXIgQ2xhc3NBIENBMR8wHQYDVQQDExZORVRDQSBTZXJ2ZXIgQ2xhc3NBIENBMB4XDTEyMDUyMzE2"+
//"MDAwMFoXDTEzMDUyNDE1NTk1OVowbjELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nZG9uZzEn"+
//"MCUGA1UECh4eWSl//HU1W1BVRlKhZwmWUFFsU/hef04cUgZRbFP4MSIwIAYDVQQDExllbnRlcnBy"+
//"aXNlLmJlc3RwYXkuY29tLmNuMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCXJj30rLaut9yx"+
//"T+yeuPGIeDhcVGMZuxJ03ygkmckhJwzrefULtSh0XUMheYPpUgZfn7UKNN1cbMUTLMYd5KMSQdlt"+
//"AiTsUcmi2SW27ikVowfjA9yMwYQ/7d+HTcOvalfCd2k6KHByahig02LC7BpNXtPdDPN7A5QjJcfT"+
//"4lxgwwIDAQABo4IBHjCCARowHwYDVR0jBBgwFoAUuvNKBSTm+CTI5lfaeI0MWeRDZMowHQYDVR0O"+
//"BBYEFIMIQX6GW79AxsltJr2aYBQZS+GhMFcGA1UdIARQME4wTAYKKwYBBAGBkkgBCjA+MDwGCCsG"+
//"AQUFBwIBFjBodHRwOi8vd3d3LmNuY2EubmV0L2NzL2tub3dsZWRnZS93aGl0ZXBhcGVyL2Nwcy8w"+
//"JAYDVR0RBB0wG4IZZW50ZXJwcmlzZS5iZXN0cGF5LmNvbS5jbjAMBgNVHRMBAf8EAjAAMA4GA1Ud"+
//"DwEB/wQEAwIEsDA7BgNVHR8ENDAyMDCgLqAshipodHRwOi8vY2xhc3NhY2ExLmNuY2EubmV0L2Ny"+
//"bC9TZXJ2ZXJDQS5jcmwwDQYJKoZIhvcNAQEFBQADggEBAAX3psJhH/4+au2N8PnWsHtk5Nx7sOb6"+
//"h0kc+tIptof3A1GzvOLh/xVwtB2vDvd4YuZy6oT81JGMocL4+iO/Vi3qF0ut/cN2t6lFNdmNPo7/"+
//"rkrRDNNVKwix9K+xeW6+SwNnATlc8/9SM5b1z8bTs5JCq9F7fDRyA5AquAPYjXTOw4Tt33NaX0Gv"+
//"+IbF4rPzI/qTWTGlS63/fmMiCncwHXLfcS3eWxpVMGC7CExtLEwBHDaZWa9yztkKn/rQAduHb7VS"+
//"pSQ6bvZXONa2ltMTe1xhgP9zpCRtGUXE9Rnzh2ZscG8ajA4kK2cxellzCLshsafxnngbWRWC8wHp"+
//"4Y/gqK0=";
		String sBase64Cert = "MIIEdTCCA12gAwIBAgIQeOYX576OwdBzGHctPw6PSTANBgkqhkiG9w0BAQUFADBvMQswCQYDVQQGEwJDTjEkMCIGA1UEChMbTkVUQ0EgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MRkwFwYDVQQLExBTZXJ2ZXIgQ2xhc3NBIENBMR8wHQYDVQQDExZORVRDQSBTZXJ2ZXIgQ2xhc3NBIENBMB4XDTEyMDMzMTE2MDAwMFoXDTE1MDQwMTE1NTk1OVowZzELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nZG9uZzErMCkGA1UECh4iZw1SoVZoi8FOZm1Li9UAMgAwADEAMgAwADQAMAAxAC0ANDEXMBUGA1UEAxMOdGVzdDIwMTIwNDAxLTQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDYWtX4YTIYgmXAC6l2E//GQ1SjymJyPGNoDav+MJtUpXzcdub4yfKiLa6HWzzKUl9YyokwGtMUu020+8yy6BUNlmElcgrdqmZyej8fjlzjCw8BLwrxxKcbR9HZ8OEu1VSpy1w/KYpCEqT1gi4T3LP+Ug2SVbIXuFMsPSwywwVtl8mMcXQ3PqjD72IK+cOnWCimFk590uLlnyy6/z3vMa+XbjUG3haoCS8WLsJNufbs8HccTE6FYctCDNuSwhD7YOqKlMoMFnFnEN6wvZ57GS3NM1dd2sSqE4Ma8gE75w3VdOuoKsjnWfrGkbhkUmBiVuACt+/Aw3m8mngx33qyKjURAgMBAAGjggETMIIBDzAfBgNVHSMEGDAWgBS680oFJOb4JMjmV9p4jQxZ5ENkyjAdBgNVHQ4EFgQUKl+CBlrjAlL1DUAJs4M2QqAq2xMwVwYDVR0gBFAwTjBMBgorBgEEAYGSSAEKMD4wPAYIKwYBBQUHAgEWMGh0dHA6Ly93d3cuY25jYS5uZXQvY3Mva25vd2xlZGdlL3doaXRlcGFwZXIvY3BzLzAZBgNVHREEEjAQgg50ZXN0MjAxMjA0MDEtNDAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIEsDA7BgNVHR8ENDAyMDCgLqAshipodHRwOi8vY2xhc3NhY2ExLmNuY2EubmV0L2NybC9TZXJ2ZXJDQS5jcmwwDQYJKoZIhvcNAQEFBQADggEBAJ4QaFZjJ12Ayvyy0JyNZQ9eeNmCAUt4+aZY6IT/FDfm9HFB7jkVXxDY+eUTHc/cu4fDIidCNz+CTGlRoiVWJkDyQfmBpcXJE1OPJSHzMXXDgGfxstqZDkDJ+NAAX8TSunnd4/y/BjO/uoOxytVmetxWOxt4s6IhITzZS2y7Kntoghd+6IVK20VFS9mhqUL/YiRI4RU+TrjU8zm7+QSTpqfXfOwn1x8Eol+Pwu9+ZdMNLCA8MbbtmMKz/vbxMwBoFv9kedH0ui7d5AQiNGQHxp0IGYc1L48KpLE8bDeyjGNU+VjI/gmzxYM6bwOqLpoENnWm7M3NLhtIDj98Z4Wftrc=";
//		String sBase64Cert = "MIIEAzCCAuugAwIBAgIQaByrVM2PXDnlj+FV8Vik6TANBgkqhkiG9w0BAQUFADBvMQswCQYDVQQGEwJDTjEkMCIGA1UEChMbTkVUQ0EgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MRkwFwYDVQQLExBTZXJ2ZXIgQ2xhc3NBIENBMR8wHQYDVQQDExZORVRDQSBTZXJ2ZXIgQ2xhc3NBIENBMB4XDTEyMDUyMzE2MDAwMFoXDTEzMDUyNDE1NTk1OVowbjELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nZG9uZzEnMCUGA1UECh4eWSl//HU1W1BVRlKhZwmWUFFsU/hef04cUgZRbFP4MSIwIAYDVQQDExllbnRlcnByaXNlLmJlc3RwYXkuY29tLmNuMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCXJj30rLaut9yxT+yeuPGIeDhcVGMZuxJ03ygkmckhJwzrefULtSh0XUMheYPpUgZfn7UKNN1cbMUTLMYd5KMSQdltAiTsUcmi2SW27ikVowfjA9yMwYQ/7d+HTcOvalfCd2k6KHByahig02LC7BpNXtPdDPN7A5QjJcfT4lxgwwIDAQABo4IBHjCCARowHwYDVR0jBBgwFoAUuvNKBSTm+CTI5lfaeI0MWeRDZMowHQYDVR0OBBYEFIMIQX6GW79AxsltJr2aYBQZS+GhMFcGA1UdIARQME4wTAYKKwYBBAGBkkgBCjA+MDwGCCsGAQUFBwIBFjBodHRwOi8vd3d3LmNuY2EubmV0L2NzL2tub3dsZWRnZS93aGl0ZXBhcGVyL2Nwcy8wJAYDVR0RBB0wG4IZZW50ZXJwcmlzZS5iZXN0cGF5LmNvbS5jbjAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIEsDA7BgNVHR8ENDAyMDCgLqAshipodHRwOi8vY2xhc3NhY2ExLmNuY2EubmV0L2NybC9TZXJ2ZXJDQS5jcmwwDQYJKoZIhvcNAQEFBQADggEBAAX3psJhH/4+au2N8PnWsHtk5Nx7sOb6h0kc+tIptof3A1GzvOLh/xVwtB2vDvd4YuZy6oT81JGMocL4+iO/Vi3qF0ut/cN2t6lFNdmNPo7/rkrRDNNVKwix9K+xeW6+SwNnATlc8/9SM5b1z8bTs5JCq9F7fDRyA5AquAPYjXTOw4Tt33NaX0Gv+IbF4rPzI/qTWTGlS63/fmMiCncwHXLfcS3eWxpVMGC7CExtLEwBHDaZWa9yztkKn/rQAduHb7VSpSQ6bvZXONa2ltMTe1xhgP9zpCRtGUXE9Rnzh2ZscG8ajA4kK2cxellzCLshsafxnngbWRWC8wHp4Y/gqK0=";
		// 将cer从base64转换为对象
		X509Certificate oCert = NETCAPKI.getX509Certificate(sBase64Cert);
		if(oCert==null){
			log.info("将cer从base64转换为对象失败");
			return false;
		}
//		byte[] bSource = "INTERFACETYPE=10004&TRANDATE=20130329105011&ORDERAMOUNT=100&TRADECODE=100038&SYSINFO=130329012182695&MERID=8613032200071902&RESULT=0000".getBytes();
		byte[] bSource = "<PayPlatRequestParameter><CTRL-INFO WEBSVRNAME='签约接口' WEBSVRCODE='INF01011' APPFROM='110000-TIS-1-172.19.17.152' KEEP='440106003110201308020255330520'/><PARAMETERS><ORDERSEQ>20130801153510211112</ORDERSEQ><CUSTCODE>bjdxpk@199.com</CUSTCODE><PROVINCE>110000</PROVINCE><AREACODE>11000</AREACODE><PRTNTYPE>0</PRTNTYPE><PROJECT>000</PROJECT><BRANCHPROP>通讯费</BRANCHPROP><BRANCHNAME>北京春侠</BRANCHNAME><BRANCHCODE>9109041306112034</BRANCHCODE><BANKAREA>110000</BANKAREA><VERITYPE>0001</VERITYPE><BUSITYPE>BT001</BUSITYPE><ACCNAME>北京春侠</ACCNAME><BANKACCT>1234567890</BANKACCT><BANKINFO>翼支付-农业银行【63】</BANKINFO><BANKCODE>63</BANKCODE><PRIVATEFLAG>1</PRIVATEFLAG><CARDFLAG>1</CARDFLAG><CERTCODE>00</CERTCODE><CERTNO>1</CERTNO><CONTACTPHONE>1</CONTACTPHONE><CONTACTADDR>1</CONTACTADDR><RECVCORP>中国电信股份有限公司北京分公司</RECVCORP><CREDITVALIDTIME/><CREDITVALIDCODE/><MEMO/><REMARK/><REMARK2/></PARAMETERS></PayPlatRequestParameter>".getBytes();
		byte[] bSignData3 = NETCAPKI.signPKCS1(bSource);
		String sign = new String(Base64.encode(bSignData3));
		System.out.println(sign);
//		byte[] bSignData3 = Base64.decode("fA9d7Ulm8BQHIINvsQ2POpshrqQZ3GkMlcF5R/LZppd5U/UiSzaooRUvTiXpmMfGHKWbOmv0Dp01"+
//"hyqNiy9DbFoNed3Sp/YJUK0R+Fnx1bCD3zT3B7PHLXCoaSNiQa33VNUOWssQDB2BLo7kMFPFirGL"+
//"CwVg3IegjX1xTdhBa64=");
//		byte[] bSignData3 =Base64.decode("jNinuJpBCG8n7c1ngxPIeKSGQ6VTjdS6D3rwKPVjBOHyzoysONPMpWfTlrVcgCBdVGBhR1ba9TrBuZZBz+jg8Wo5QQL0CVftH3CQkC/+rUq3D5EuPBw1O/Goym5A//jn4H8V5kHvUl3NEYgNOMe6JrXRnfJ6bp9Zi4vVK24Ibv/ytPrC2V3XuBzZinbSZiTgbH8WZKLyQDcO7ybKTWIweQrk3HLQJji2Fd119cDks8f2gtmdI+EozogDN5DjgYJmJgKIQfY6scZZIhgyjGRxIDolvaBTEg0W/o2w9NC6U2WJri63uR63/qicdPrBPTrbmx5PdLBov3Amke7DCKYBHA==");
		boolean isOK = NETCAPKI.verifyPKCS1(bSource, bSignData3, oCert);
			System.out.println(isOK);
		return isOK;
     }
}
